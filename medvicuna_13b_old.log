[2023-06-03 00:52:18,205] [INFO] [multinode_runner.py:70:get_cmd] Running on the following workers: Ai4bio-alpa2,Ai4bio-alpa3
[2023-06-03 00:52:18,206] [INFO] [runner.py:541:main] cmd = pdsh -S -f 1024 -w Ai4bio-alpa2,Ai4bio-alpa3 export PYTHONPATH=/home/chong.tian/code/MedVicuna;  cd /home/chong.tian/code/MedVicuna; /home/chong.tian/.conda/envs/med/bin/python -u -m deepspeed.launcher.launch --world_info=eyJBaTRiaW8tYWxwYTIiOiBbMCwgMSwgMiwgM10sICJBaTRiaW8tYWxwYTMiOiBbMCwgMSwgMiwgM119 --node_rank=%n --master_addr=Ai4bio-alpa2 --master_port=20002 fastchat/train/train_mem.py --model_name_or_path 'eachadea/vicuna-13b-1.1' --data_path './medVicuna.json' --bf16 'True' --output_dir 'output_medvicuna_13b/' --num_train_epochs '5' --per_device_train_batch_size '1' --per_device_eval_batch_size '32' --gradient_accumulation_steps '32' --save_strategy 'epoch' --save_total_limit '10' --learning_rate '2e-5' --weight_decay '0.' --warmup_ratio '0.04' --lr_scheduler_type 'cosine' --logging_steps '1' --model_max_length '1024' --gradient_checkpointing 'True' --lazy_preprocess 'True' --deepspeed './configs/default_offload_opt_param.json' --tf32 'True'
Ai4bio-alpa2: [2023-06-03 00:52:20,798] [INFO] [launch.py:229:main] WORLD INFO DICT: {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [0, 1, 2, 3]}
Ai4bio-alpa2: [2023-06-03 00:52:20,798] [INFO] [launch.py:235:main] nnodes=2, num_local_procs=4, node_rank=0
Ai4bio-alpa2: [2023-06-03 00:52:20,798] [INFO] [launch.py:246:main] global_rank_mapping=defaultdict(<class 'list'>, {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [4, 5, 6, 7]})
Ai4bio-alpa2: [2023-06-03 00:52:20,798] [INFO] [launch.py:247:main] dist_world_size=8
Ai4bio-alpa2: [2023-06-03 00:52:20,798] [INFO] [launch.py:249:main] Setting CUDA_VISIBLE_DEVICES=0,1,2,3
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: [2023-06-03 00:52:23,718] [INFO] [launch.py:229:main] WORLD INFO DICT: {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [0, 1, 2, 3]}
Ai4bio-alpa3: [2023-06-03 00:52:23,718] [INFO] [launch.py:235:main] nnodes=2, num_local_procs=4, node_rank=1
Ai4bio-alpa3: [2023-06-03 00:52:23,718] [INFO] [launch.py:246:main] global_rank_mapping=defaultdict(<class 'list'>, {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [4, 5, 6, 7]})
Ai4bio-alpa3: [2023-06-03 00:52:23,718] [INFO] [launch.py:247:main] dist_world_size=8
Ai4bio-alpa3: [2023-06-03 00:52:23,718] [INFO] [launch.py:249:main] Setting CUDA_VISIBLE_DEVICES=0,1,2,3
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: ------------------------------------
Ai4bio-alpa3: 
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: 
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: [2023-06-03 00:52:24,236] [INFO] [comm.py:622:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: [2023-06-03 00:52:32,070] [INFO] [partition_parameters.py:454:__exit__] finished initializing model with 13.02B parameters
Ai4bio-alpa2: Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.15s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.39s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.30s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:19<00:39, 19.51s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:26<00:13, 13.00s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:25<00:12, 12.96s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:26<00:13, 13.05s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.19s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.26s/it]
Ai4bio-alpa2: Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.24s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.30s/it]
Ai4bio-alpa2: Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.22s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.25s/it]
Ai4bio-alpa3: Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.20s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:11<00:23, 11.95s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.07s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.29s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.43s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.32s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.37s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.45s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.43s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.21s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.71s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.11s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.86s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.26s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.73s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.17s/it]
Ai4bio-alpa2: Loading checkpoint shards:  67%|██████▋   | 2/3 [00:32<00:15, 15.42s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:40<00:00, 12.13s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:40<00:00, 13.43s/it]
Ai4bio-alpa3: Loading data...
Ai4bio-alpa2: Loading data...
Ai4bio-alpa3: #train 475139, #eval 9697
Ai4bio-alpa3: Formatting inputs...Skip in lazy mode
Ai4bio-alpa3: Formatting inputs...Skip in lazy mode
Ai4bio-alpa2: #train 475139, #eval 9697
Ai4bio-alpa2: Formatting inputs...Skip in lazy mode
Ai4bio-alpa2: Formatting inputs...Skip in lazy mode
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Detected CUDA files, patching ldflags
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Detected CUDA files, patching ldflags
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1508 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1505 │   │   │   │   │   │                                                 │
Ai4bio-alpa2: │   1506 │   │   │   │   │   │   sources = list(hipified_sources)              │
Ai4bio-alpa2: │   1507 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1508 │   │   │   │   │   _write_ninja_file_and_build_library(              │
Ai4bio-alpa2: │   1509 │   │   │   │   │   │   name=name,                                    │
Ai4bio-alpa2: │   1510 │   │   │   │   │   │   sources=sources,                              │
Ai4bio-alpa2: │   1511 │   │   │   │   │   │   extra_cflags=extra_cflags or [],              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1600 in _write_ninja_file_and_build_library                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1597 │   get_compiler_abi_compatibility_and_version(compiler)              │
Ai4bio-alpa2: │   1598 │   if with_cuda is None:                                             │
Ai4bio-alpa2: │   1599 │   │   with_cuda = any(map(_is_cuda_file, sources))                  │
Ai4bio-alpa2: │ ❱ 1600 │   extra_ldflags = _prepare_ldflags(                                 │
Ai4bio-alpa2: │   1601 │   │   extra_ldflags or [],                                          │
Ai4bio-alpa2: │   1602 │   │   with_cuda,                                                    │
Ai4bio-alpa2: │   1603 │   │   verbose,                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1709 in _prepare_ldflags                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1706 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1707 │   │   │   │   extra_ldflags.append(os.path.join(CUDNN_HOME, "lib",  │
Ai4bio-alpa2: │   1708 │   │   elif not IS_HIP_EXTENSION:                                    │
Ai4bio-alpa2: │ ❱ 1709 │   │   │   extra_ldflags.append(f'-L{_join_cuda_home("lib64")}')     │
Ai4bio-alpa2: │   1710 │   │   │   extra_ldflags.append('-lcudart')                          │
Ai4bio-alpa2: │   1711 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1712 │   │   │   │   extra_ldflags.append(f'-L{os.path.join(CUDNN_HOME, "l │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:2231 in _join_cuda_home                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   2228 │   only once we need to get any CUDA-specific path.                  │
Ai4bio-alpa2: │   2229 │   '''                                                               │
Ai4bio-alpa2: │   2230 │   if CUDA_HOME is None:                                             │
Ai4bio-alpa2: │ ❱ 2231 │   │   raise EnvironmentError('CUDA_HOME environment variable is not │
Ai4bio-alpa2: │   2232 │   │   │   │   │   │   │      'Please set it to your CUDA install ro │
Ai4bio-alpa2: │   2233 │   return os.path.join(CUDA_HOME, *paths)                            │
Ai4bio-alpa2: │   2234                                                                       │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: OSError: CUDA_HOME environment variable is not set. Please set it to your CUDA 
Ai4bio-alpa2: install root.
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1508 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1505 │   │   │   │   │   │                                                 │
Ai4bio-alpa3: │   1506 │   │   │   │   │   │   sources = list(hipified_sources)              │
Ai4bio-alpa3: │   1507 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1508 │   │   │   │   │   _write_ninja_file_and_build_library(              │
Ai4bio-alpa3: │   1509 │   │   │   │   │   │   name=name,                                    │
Ai4bio-alpa3: │   1510 │   │   │   │   │   │   sources=sources,                              │
Ai4bio-alpa3: │   1511 │   │   │   │   │   │   extra_cflags=extra_cflags or [],              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1600 in _write_ninja_file_and_build_library                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1597 │   get_compiler_abi_compatibility_and_version(compiler)              │
Ai4bio-alpa3: │   1598 │   if with_cuda is None:                                             │
Ai4bio-alpa3: │   1599 │   │   with_cuda = any(map(_is_cuda_file, sources))                  │
Ai4bio-alpa3: │ ❱ 1600 │   extra_ldflags = _prepare_ldflags(                                 │
Ai4bio-alpa3: │   1601 │   │   extra_ldflags or [],                                          │
Ai4bio-alpa3: │   1602 │   │   with_cuda,                                                    │
Ai4bio-alpa3: │   1603 │   │   verbose,                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1709 in _prepare_ldflags                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1706 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa3: │   1707 │   │   │   │   extra_ldflags.append(os.path.join(CUDNN_HOME, "lib",  │
Ai4bio-alpa3: │   1708 │   │   elif not IS_HIP_EXTENSION:                                    │
Ai4bio-alpa3: │ ❱ 1709 │   │   │   extra_ldflags.append(f'-L{_join_cuda_home("lib64")}')     │
Ai4bio-alpa3: │   1710 │   │   │   extra_ldflags.append('-lcudart')                          │
Ai4bio-alpa3: │   1711 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa3: │   1712 │   │   │   │   extra_ldflags.append(f'-L{os.path.join(CUDNN_HOME, "l │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:2231 in _join_cuda_home                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   2228 │   only once we need to get any CUDA-specific path.                  │
Ai4bio-alpa3: │   2229 │   '''                                                               │
Ai4bio-alpa3: │   2230 │   if CUDA_HOME is None:                                             │
Ai4bio-alpa3: │ ❱ 2231 │   │   raise EnvironmentError('CUDA_HOME environment variable is not │
Ai4bio-alpa3: │   2232 │   │   │   │   │   │   │      'Please set it to your CUDA install ro │
Ai4bio-alpa3: │   2233 │   return os.path.join(CUDA_HOME, *paths)                            │
Ai4bio-alpa3: │   2234                                                                       │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: OSError: CUDA_HOME environment variable is not set. Please set it to your CUDA 
Ai4bio-alpa3: install root.
Ai4bio-alpa2: Loading extension module fused_adam...
Ai4bio-alpa2: Loading extension module fused_adam...
Ai4bio-alpa2: Loading extension module fused_adam...
Ai4bio-alpa3: [2023-06-03 00:53:19,778] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3848298
Ai4bio-alpa3: [2023-06-03 00:53:19,812] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3848299
Ai4bio-alpa3: [2023-06-03 00:53:19,837] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3848300
Ai4bio-alpa2: [2023-06-03 00:53:19,864] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1760228
Ai4bio-alpa2: [2023-06-03 00:53:19,865] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1760229
Ai4bio-alpa3: [2023-06-03 00:53:20,156] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3848301
Ai4bio-alpa3: [2023-06-03 00:53:20,156] [ERROR] [launch.py:434:sigkill_handler] ['/home/chong.tian/.conda/envs/med/bin/python', '-u', 'fastchat/train/train_mem.py', '--local_rank=3', '--model_name_or_path', 'eachadea/vicuna-13b-1.1', '--data_path', './medVicuna.json', '--bf16', 'True', '--output_dir', 'output_medvicuna_13b/', '--num_train_epochs', '5', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '32', '--gradient_accumulation_steps', '32', '--save_strategy', 'epoch', '--save_total_limit', '10', '--learning_rate', '2e-5', '--weight_decay', '0.', '--warmup_ratio', '0.04', '--lr_scheduler_type', 'cosine', '--logging_steps', '1', '--model_max_length', '1024', '--gradient_checkpointing', 'True', '--lazy_preprocess', 'True', '--deepspeed', './configs/default_offload_opt_param.json', '--tf32', 'True'] exits with return code = 1
Ai4bio-alpa2: [2023-06-03 00:53:20,198] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1760230
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa2: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa2: │   1533 │                                                                     │
Ai4bio-alpa2: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa2: │   1535                                                                       │
Ai4bio-alpa2: │   1536                                                                       │
Ai4bio-alpa2: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa2: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa2: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa2: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa2: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa2: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa2: │   1940 │   │   return module                                                 │
Ai4bio-alpa2: │ in module_from_spec:571                                                      │
Ai4bio-alpa2: │ in create_module:1176                                                        │
Ai4bio-alpa2: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: ImportError: 
Ai4bio-alpa2: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa2: cannot open shared object file: No such file or directory
pdsh@Ai4bio-alpa2: Ai4bio-alpa3: ssh exited with exit code 1
Ai4bio-alpa2: [2023-06-03 00:53:20,575] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1760231
Ai4bio-alpa2: [2023-06-03 00:53:20,951] [ERROR] [launch.py:434:sigkill_handler] ['/home/chong.tian/.conda/envs/med/bin/python', '-u', 'fastchat/train/train_mem.py', '--local_rank=3', '--model_name_or_path', 'eachadea/vicuna-13b-1.1', '--data_path', './medVicuna.json', '--bf16', 'True', '--output_dir', 'output_medvicuna_13b/', '--num_train_epochs', '5', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '32', '--gradient_accumulation_steps', '32', '--save_strategy', 'epoch', '--save_total_limit', '10', '--learning_rate', '2e-5', '--weight_decay', '0.', '--warmup_ratio', '0.04', '--lr_scheduler_type', 'cosine', '--logging_steps', '1', '--model_max_length', '1024', '--gradient_checkpointing', 'True', '--lazy_preprocess', 'True', '--deepspeed', './configs/default_offload_opt_param.json', '--tf32', 'True'] exits with return code = 1
pdsh@Ai4bio-alpa2: Ai4bio-alpa2: ssh exited with exit code 1
[2023-06-03 05:31:00,958] [INFO] [multinode_runner.py:70:get_cmd] Running on the following workers: Ai4bio-alpa2,Ai4bio-alpa3
[2023-06-03 05:31:00,959] [INFO] [runner.py:541:main] cmd = pdsh -S -f 1024 -w Ai4bio-alpa2,Ai4bio-alpa3 export PYTHONPATH=/home/chong.tian/code/MedVicuna;  cd /home/chong.tian/code/MedVicuna; /home/chong.tian/.conda/envs/med/bin/python -u -m deepspeed.launcher.launch --world_info=eyJBaTRiaW8tYWxwYTIiOiBbMCwgMSwgMiwgM10sICJBaTRiaW8tYWxwYTMiOiBbMCwgMSwgMiwgM119 --node_rank=%n --master_addr=Ai4bio-alpa2 --master_port=20002 fastchat/train/train_mem.py --model_name_or_path 'eachadea/vicuna-13b-1.1' --data_path './medVicuna.json' --bf16 'True' --output_dir 'output_medvicuna_13b/' --num_train_epochs '5' --per_device_train_batch_size '1' --per_device_eval_batch_size '32' --gradient_accumulation_steps '32' --save_strategy 'epoch' --save_total_limit '10' --learning_rate '2e-5' --weight_decay '0.' --warmup_ratio '0.04' --lr_scheduler_type 'cosine' --logging_steps '1' --model_max_length '1024' --gradient_checkpointing 'True' --lazy_preprocess 'True' --deepspeed './configs/default_offload_opt_param.json' --tf32 'True'
Ai4bio-alpa2: [2023-06-03 05:31:03,484] [INFO] [launch.py:229:main] WORLD INFO DICT: {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [0, 1, 2, 3]}
Ai4bio-alpa2: [2023-06-03 05:31:03,484] [INFO] [launch.py:235:main] nnodes=2, num_local_procs=4, node_rank=0
Ai4bio-alpa2: [2023-06-03 05:31:03,484] [INFO] [launch.py:246:main] global_rank_mapping=defaultdict(<class 'list'>, {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [4, 5, 6, 7]})
Ai4bio-alpa2: [2023-06-03 05:31:03,485] [INFO] [launch.py:247:main] dist_world_size=8
Ai4bio-alpa2: [2023-06-03 05:31:03,485] [INFO] [launch.py:249:main] Setting CUDA_VISIBLE_DEVICES=0,1,2,3
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: ------------------
Ai4bio-alpa2: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: [2023-06-03 05:31:06,849] [INFO] [comm.py:622:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
Ai4bio-alpa3: [2023-06-03 05:31:07,279] [INFO] [launch.py:229:main] WORLD INFO DICT: {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [0, 1, 2, 3]}
Ai4bio-alpa3: [2023-06-03 05:31:07,279] [INFO] [launch.py:235:main] nnodes=2, num_local_procs=4, node_rank=1
Ai4bio-alpa3: [2023-06-03 05:31:07,279] [INFO] [launch.py:246:main] global_rank_mapping=defaultdict(<class 'list'>, {'Ai4bio-alpa2': [0, 1, 2, 3], 'Ai4bio-alpa3': [4, 5, 6, 7]})
Ai4bio-alpa3: [2023-06-03 05:31:07,279] [INFO] [launch.py:247:main] dist_world_size=8
Ai4bio-alpa3: [2023-06-03 05:31:07,279] [INFO] [launch.py:249:main] Setting CUDA_VISIBLE_DEVICES=0,1,2,3
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa3: ------------------
Ai4bio-alpa3: ['/home/chong.tian/code/MedVicuna', '/home/chong.tian/code/MedVicuna/fastchat/train', '/home/chong.tian/code/MedVicuna', '/home/chong.tian/.conda/envs/med/lib/python310.zip', '/home/chong.tian/.conda/envs/med/lib/python3.10', '/home/chong.tian/.conda/envs/med/lib/python3.10/lib-dynload', '/home/chong.tian/.conda/envs/med/lib/python3.10/site-packages']
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libvmw_pvrdma-rdmav25.so': libvmw_pvrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libsiw-rdmav25.so': libsiw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'librxe-rdmav25.so': librxe-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libqedr-rdmav25.so': libqedr-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libocrdma-rdmav25.so': libocrdma-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmthca-rdmav25.so': libmthca-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx5-rdmav25.so': libmlx5-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libmlx4-rdmav25.so': libmlx4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libipathverbs-rdmav25.so': libipathverbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libi40iw-rdmav25.so': libi40iw-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhns-rdmav25.so': libhns-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libhfi1verbs-rdmav25.so': libhfi1verbs-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libefa-rdmav25.so': libefa-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libcxgb4-rdmav25.so': libcxgb4-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa3: libibverbs: Warning: couldn't load driver 'libbnxt_re-rdmav25.so': libbnxt_re-rdmav25.so: cannot open shared object file: No such file or directory
Ai4bio-alpa2: [2023-06-03 05:31:15,223] [INFO] [partition_parameters.py:454:__exit__] finished initializing model with 13.02B parameters
Ai4bio-alpa2: Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.13s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.17s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:13<00:26, 13.27s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:18<00:37, 18.66s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:25<00:12, 12.71s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:25<00:12, 12.73s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:25<00:12, 12.75s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  8.98s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.05s/it]
Ai4bio-alpa2: Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.01s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.06s/it]
Ai4bio-alpa2: Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.03s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.07s/it]
Ai4bio-alpa3: Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.04s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:11<00:23, 11.88s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.03s/it]Loading checkpoint shards:  33%|███▎      | 1/3 [00:12<00:24, 12.40s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.37s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.24s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:24<00:12, 12.24s/it]Loading checkpoint shards:  67%|██████▋   | 2/3 [00:25<00:12, 12.55s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00,  9.47s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:30<00:00, 10.28s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.73s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.14s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.57s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.00s/it]
Ai4bio-alpa3: Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 10.63s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:33<00:00, 11.03s/it]
Ai4bio-alpa2: Loading checkpoint shards:  67%|██████▋   | 2/3 [00:31<00:15, 15.02s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:39<00:00, 11.87s/it]Loading checkpoint shards: 100%|██████████| 3/3 [00:39<00:00, 13.08s/it]
Ai4bio-alpa2: Loading data...
Ai4bio-alpa3: Loading data...
Ai4bio-alpa2: #train 475139, #eval 9697
Ai4bio-alpa2: Formatting inputs...Skip in lazy mode
Ai4bio-alpa2: Formatting inputs...Skip in lazy mode
Ai4bio-alpa3: #train 475139, #eval 9697
Ai4bio-alpa3: Formatting inputs...Skip in lazy mode
Ai4bio-alpa3: Formatting inputs...Skip in lazy mode
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Detected CUDA files, patching ldflags
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Detected CUDA files, patching ldflags
Ai4bio-alpa2: Loading extension module fused_adam...
Ai4bio-alpa3: Using /home/chong.tian/.cache/torch_extensions/py310_cu116 as PyTorch extensions root...
Ai4bio-alpa2: Loading extension module fused_adam...
Ai4bio-alpa3: Detected CUDA files, patching ldflags
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa3: Loading extension module fused_adam...
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa2: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa2: │   1533 │                                                                     │
Ai4bio-alpa2: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa2: │   1535                                                                       │
Ai4bio-alpa2: │   1536                                                                       │
Ai4bio-alpa2: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa2: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa2: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa2: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa2: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa2: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa2: │   1940 │   │   return module                                                 │
Ai4bio-alpa2: │ in module_from_spec:571                                                      │
Ai4bio-alpa2: │ in create_module:1176                                                        │
Ai4bio-alpa2: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: ImportError: 
Ai4bio-alpa2: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa2: cannot open shared object file: No such file or directory
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa2: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa2: │   1533 │                                                                     │
Ai4bio-alpa2: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa2: │   1535                                                                       │
Ai4bio-alpa2: │   1536                                                                       │
Ai4bio-alpa2: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa2: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa2: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa2: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa2: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa2: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa2: │   1940 │   │   return module                                                 │
Ai4bio-alpa2: │ in module_from_spec:571                                                      │
Ai4bio-alpa2: │ in create_module:1176                                                        │
Ai4bio-alpa2: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: ImportError: 
Ai4bio-alpa2: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa2: cannot open shared object file: No such file or directory
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1508 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1505 │   │   │   │   │   │                                                 │
Ai4bio-alpa2: │   1506 │   │   │   │   │   │   sources = list(hipified_sources)              │
Ai4bio-alpa2: │   1507 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1508 │   │   │   │   │   _write_ninja_file_and_build_library(              │
Ai4bio-alpa2: │   1509 │   │   │   │   │   │   name=name,                                    │
Ai4bio-alpa2: │   1510 │   │   │   │   │   │   sources=sources,                              │
Ai4bio-alpa2: │   1511 │   │   │   │   │   │   extra_cflags=extra_cflags or [],              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1600 in _write_ninja_file_and_build_library                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1597 │   get_compiler_abi_compatibility_and_version(compiler)              │
Ai4bio-alpa2: │   1598 │   if with_cuda is None:                                             │
Ai4bio-alpa2: │   1599 │   │   with_cuda = any(map(_is_cuda_file, sources))                  │
Ai4bio-alpa2: │ ❱ 1600 │   extra_ldflags = _prepare_ldflags(                                 │
Ai4bio-alpa2: │   1601 │   │   extra_ldflags or [],                                          │
Ai4bio-alpa2: │   1602 │   │   with_cuda,                                                    │
Ai4bio-alpa2: │   1603 │   │   verbose,                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1709 in _prepare_ldflags                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1706 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1707 │   │   │   │   extra_ldflags.append(os.path.join(CUDNN_HOME, "lib",  │
Ai4bio-alpa2: │   1708 │   │   elif not IS_HIP_EXTENSION:                                    │
Ai4bio-alpa2: │ ❱ 1709 │   │   │   extra_ldflags.append(f'-L{_join_cuda_home("lib64")}')     │
Ai4bio-alpa2: │   1710 │   │   │   extra_ldflags.append('-lcudart')                          │
Ai4bio-alpa2: │   1711 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1712 │   │   │   │   extra_ldflags.append(f'-L{os.path.join(CUDNN_HOME, "l │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:2231 in _join_cuda_home                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   2228 │   only once we need to get any CUDA-specific path.                  │
Ai4bio-alpa2: │   2229 │   '''                                                               │
Ai4bio-alpa2: │   2230 │   if CUDA_HOME is None:                                             │
Ai4bio-alpa2: │ ❱ 2231 │   │   raise EnvironmentError('CUDA_HOME environment variable is not │
Ai4bio-alpa2: │   2232 │   │   │   │   │   │   │      'Please set it to your CUDA install ro │
Ai4bio-alpa2: │   2233 │   return os.path.join(CUDA_HOME, *paths)                            │
Ai4bio-alpa2: │   2234                                                                       │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: OSError: CUDA_HOME environment variable is not set. Please set it to your CUDA 
Ai4bio-alpa2: install root.
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1534 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1531 │   if is_standalone:                                                 │
Ai4bio-alpa3: │   1532 │   │   return _get_exec_path(name, build_directory)                  │
Ai4bio-alpa3: │   1533 │                                                                     │
Ai4bio-alpa3: │ ❱ 1534 │   return _import_module_from_library(name, build_directory, is_pyth │
Ai4bio-alpa3: │   1535                                                                       │
Ai4bio-alpa3: │   1536                                                                       │
Ai4bio-alpa3: │   1537 def _write_ninja_file_and_compile_objects(                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1937 in _import_module_from_library                           │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1934 │   │   # https://stackoverflow.com/questions/67631/how-to-import-a-m │
Ai4bio-alpa3: │   1935 │   │   spec = importlib.util.spec_from_file_location(module_name, fi │
Ai4bio-alpa3: │   1936 │   │   assert spec is not None                                       │
Ai4bio-alpa3: │ ❱ 1937 │   │   module = importlib.util.module_from_spec(spec)                │
Ai4bio-alpa3: │   1938 │   │   assert isinstance(spec.loader, importlib.abc.Loader)          │
Ai4bio-alpa3: │   1939 │   │   spec.loader.exec_module(module)                               │
Ai4bio-alpa3: │   1940 │   │   return module                                                 │
Ai4bio-alpa3: │ in module_from_spec:571                                                      │
Ai4bio-alpa3: │ in create_module:1176                                                        │
Ai4bio-alpa3: │ in _call_with_frames_removed:241                                             │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: ImportError: 
Ai4bio-alpa3: /home/chong.tian/.cache/torch_extensions/py310_cu116/fused_adam/fused_adam.so: 
Ai4bio-alpa3: cannot open shared object file: No such file or directory
Ai4bio-alpa2: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa2: │   19                                                                         │
Ai4bio-alpa2: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa2: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa2: │   22                                                                         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa2: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa2: │   262 │   else:                                                              │
Ai4bio-alpa2: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa2: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa2: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa2: │   266                                                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa2: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa2: │   1661 │   │   )                                                             │
Ai4bio-alpa2: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa2: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa2: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa2: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa2: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa2: │   1729 │   │   )                                                             │
Ai4bio-alpa2: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa2: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa2: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa2: │   1733 │   │   │   )                                                         │
Ai4bio-alpa2: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa2: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa2: │   376 │   }                                                                  │
Ai4bio-alpa2: │   377 │                                                                      │
Ai4bio-alpa2: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa2: │   379 │                                                                      │
Ai4bio-alpa2: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa2: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa2: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa2: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa2: │   164 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa2: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa2: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa2: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa2: │    306 │   │                                                                 │
Ai4bio-alpa2: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa2: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa2: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa2: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa2: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa2: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa2: │   1161 │   │   else:                                                         │
Ai4bio-alpa2: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa2: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa2: │   1164 │   │                                                                 │
Ai4bio-alpa2: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa2: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa2: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa2: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa2: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa2: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa2: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa2: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa2: │    70 │   │                                                                  │
Ai4bio-alpa2: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa2: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa2: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa2: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   442 │   │   │                                                              │
Ai4bio-alpa2: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa2: │   444 │   │   else:                                                          │
Ai4bio-alpa2: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa2: │   446 │                                                                      │
Ai4bio-alpa2: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa2: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa2: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa2: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa2: │   479 │   │                                                                  │
Ai4bio-alpa2: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa2: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa2: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa2: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa2: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa2: │   1283 │   '''                                                               │
Ai4bio-alpa2: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa2: │   1285 │   │   name,                                                         │
Ai4bio-alpa2: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa2: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1508 in _jit_compile                                          │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1505 │   │   │   │   │   │                                                 │
Ai4bio-alpa2: │   1506 │   │   │   │   │   │   sources = list(hipified_sources)              │
Ai4bio-alpa2: │   1507 │   │   │   │   │                                                     │
Ai4bio-alpa2: │ ❱ 1508 │   │   │   │   │   _write_ninja_file_and_build_library(              │
Ai4bio-alpa2: │   1509 │   │   │   │   │   │   name=name,                                    │
Ai4bio-alpa2: │   1510 │   │   │   │   │   │   sources=sources,                              │
Ai4bio-alpa2: │   1511 │   │   │   │   │   │   extra_cflags=extra_cflags or [],              │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1600 in _write_ninja_file_and_build_library                   │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1597 │   get_compiler_abi_compatibility_and_version(compiler)              │
Ai4bio-alpa2: │   1598 │   if with_cuda is None:                                             │
Ai4bio-alpa2: │   1599 │   │   with_cuda = any(map(_is_cuda_file, sources))                  │
Ai4bio-alpa2: │ ❱ 1600 │   extra_ldflags = _prepare_ldflags(                                 │
Ai4bio-alpa2: │   1601 │   │   extra_ldflags or [],                                          │
Ai4bio-alpa2: │   1602 │   │   with_cuda,                                                    │
Ai4bio-alpa2: │   1603 │   │   verbose,                                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:1709 in _prepare_ldflags                                      │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   1706 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1707 │   │   │   │   extra_ldflags.append(os.path.join(CUDNN_HOME, "lib",  │
Ai4bio-alpa2: │   1708 │   │   elif not IS_HIP_EXTENSION:                                    │
Ai4bio-alpa2: │ ❱ 1709 │   │   │   extra_ldflags.append(f'-L{_join_cuda_home("lib64")}')     │
Ai4bio-alpa2: │   1710 │   │   │   extra_ldflags.append('-lcudart')                          │
Ai4bio-alpa2: │   1711 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa2: │   1712 │   │   │   │   extra_ldflags.append(f'-L{os.path.join(CUDNN_HOME, "l │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa2: │ p_extension.py:2231 in _join_cuda_home                                       │
Ai4bio-alpa2: │                                                                              │
Ai4bio-alpa2: │   2228 │   only once we need to get any CUDA-specific path.                  │
Ai4bio-alpa2: │   2229 │   '''                                                               │
Ai4bio-alpa2: │   2230 │   if CUDA_HOME is None:                                             │
Ai4bio-alpa2: │ ❱ 2231 │   │   raise EnvironmentError('CUDA_HOME environment variable is not │
Ai4bio-alpa2: │   2232 │   │   │   │   │   │   │      'Please set it to your CUDA install ro │
Ai4bio-alpa2: │   2233 │   return os.path.join(CUDA_HOME, *paths)                            │
Ai4bio-alpa2: │   2234                                                                       │
Ai4bio-alpa2: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa2: OSError: CUDA_HOME environment variable is not set. Please set it to your CUDA 
Ai4bio-alpa2: install root.
Ai4bio-alpa3: ╭───────────────────── Traceback (most recent call last) ──────────────────────╮
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train_mem.py:21 in <module>   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   18 from fastchat.train.train import train                                  │
Ai4bio-alpa3: │   19                                                                         │
Ai4bio-alpa3: │   20 if __name__ == "__main__":                                              │
Ai4bio-alpa3: │ ❱ 21 │   train()                                                             │
Ai4bio-alpa3: │   22                                                                         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/code/MedVicuna/fastchat/train/train.py:263 in train         │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   260 │   if list(pathlib.Path(training_args.output_dir).glob("checkpoint-*" │
Ai4bio-alpa3: │   261 │   │   trainer.train(resume_from_checkpoint=True)                     │
Ai4bio-alpa3: │   262 │   else:                                                              │
Ai4bio-alpa3: │ ❱ 263 │   │   trainer.train()                                                │
Ai4bio-alpa3: │   264 │   # trainer.save_state()                                             │
Ai4bio-alpa3: │   265 │   safe_save_model_for_hf_trainer(trainer=trainer, output_dir=trainin │
Ai4bio-alpa3: │   266                                                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1662 in train                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1659 │   │   inner_training_loop = find_executable_batch_size(             │
Ai4bio-alpa3: │   1660 │   │   │   self._inner_training_loop, self._train_batch_size, args.a │
Ai4bio-alpa3: │   1661 │   │   )                                                             │
Ai4bio-alpa3: │ ❱ 1662 │   │   return inner_training_loop(                                   │
Ai4bio-alpa3: │   1663 │   │   │   args=args,                                                │
Ai4bio-alpa3: │   1664 │   │   │   resume_from_checkpoint=resume_from_checkpoint,            │
Ai4bio-alpa3: │   1665 │   │   │   trial=trial,                                              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/t │
Ai4bio-alpa3: │ rainer.py:1731 in _inner_training_loop                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1728 │   │   │   or self.fsdp is not None                                  │
Ai4bio-alpa3: │   1729 │   │   )                                                             │
Ai4bio-alpa3: │   1730 │   │   if args.deepspeed:                                            │
Ai4bio-alpa3: │ ❱ 1731 │   │   │   deepspeed_engine, optimizer, lr_scheduler = deepspeed_ini │
Ai4bio-alpa3: │   1732 │   │   │   │   self, num_training_steps=max_steps, resume_from_check │
Ai4bio-alpa3: │   1733 │   │   │   )                                                         │
Ai4bio-alpa3: │   1734 │   │   │   self.model = deepspeed_engine.module                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/transformers/d │
Ai4bio-alpa3: │ eepspeed.py:378 in deepspeed_init                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   375 │   │   "lr_scheduler": lr_scheduler,                                  │
Ai4bio-alpa3: │   376 │   }                                                                  │
Ai4bio-alpa3: │   377 │                                                                      │
Ai4bio-alpa3: │ ❱ 378 │   deepspeed_engine, optimizer, _, lr_scheduler = deepspeed.initializ │
Ai4bio-alpa3: │   379 │                                                                      │
Ai4bio-alpa3: │   380 │   if resume_from_checkpoint is not None:                             │
Ai4bio-alpa3: │   381 │   │   # it's possible that the user is trying to resume from model_p │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/__in │
Ai4bio-alpa3: │ it__.py:165 in initialize                                                    │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   162 │   │   │   │   │   │   │   │   │   │      config=config,              │
Ai4bio-alpa3: │   163 │   │   │   │   │   │   │   │   │   │      config_class=config_class)  │
Ai4bio-alpa3: │   164 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 165 │   │   │   engine = DeepSpeedEngine(args=args,                        │
Ai4bio-alpa3: │   166 │   │   │   │   │   │   │   │   │    model=model,                      │
Ai4bio-alpa3: │   167 │   │   │   │   │   │   │   │   │    optimizer=optimizer,              │
Ai4bio-alpa3: │   168 │   │   │   │   │   │   │   │   │    model_parameters=model_parameters │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:308 in __init__                                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    305 │   │   │   model_parameters = list(model_parameters)                 │
Ai4bio-alpa3: │    306 │   │                                                                 │
Ai4bio-alpa3: │    307 │   │   if has_optimizer:                                             │
Ai4bio-alpa3: │ ❱  308 │   │   │   self._configure_optimizer(optimizer, model_parameters)    │
Ai4bio-alpa3: │    309 │   │   │   self._configure_lr_scheduler(lr_scheduler)                │
Ai4bio-alpa3: │    310 │   │   │   self._report_progress(0)                                  │
Ai4bio-alpa3: │    311 │   │   elif self.zero_optimization():                                │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1162 in _configure_optimizer                                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1159 │   │   │   │   │   msg = f'You are using ZeRO-Offload with a client  │
Ai4bio-alpa3: │   1160 │   │   │   │   │   raise ZeRORuntimeException(msg)                   │
Ai4bio-alpa3: │   1161 │   │   else:                                                         │
Ai4bio-alpa3: │ ❱ 1162 │   │   │   basic_optimizer = self._configure_basic_optimizer(model_p │
Ai4bio-alpa3: │   1163 │   │   │   log_dist(f"Using DeepSpeed Optimizer param name {self.opt │
Ai4bio-alpa3: │   1164 │   │                                                                 │
Ai4bio-alpa3: │   1165 │   │   self._check_for_duplicates(basic_optimizer)                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/runt │
Ai4bio-alpa3: │ ime/engine.py:1224 in _configure_basic_optimizer                             │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1221 │   │   │   │   else:                                                 │
Ai4bio-alpa3: │   1222 │   │   │   │   │   from deepspeed.ops.adam import FusedAdam          │
Ai4bio-alpa3: │   1223 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1224 │   │   │   │   │   optimizer = FusedAdam(                            │
Ai4bio-alpa3: │   1225 │   │   │   │   │   │   model_parameters,                             │
Ai4bio-alpa3: │   1226 │   │   │   │   │   │   **optimizer_parameters,                       │
Ai4bio-alpa3: │   1227 │   │   │   │   │   │   adam_w_mode=effective_adam_w_mode,            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ adam/fused_adam.py:71 in __init__                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │    68 │   │   self.adam_w_mode = 1 if adam_w_mode else 0                     │
Ai4bio-alpa3: │    69 │   │   self.set_grad_none = set_grad_none                             │
Ai4bio-alpa3: │    70 │   │                                                                  │
Ai4bio-alpa3: │ ❱  71 │   │   fused_adam_cuda = FusedAdamBuilder().load()                    │
Ai4bio-alpa3: │    72 │   │   # Skip buffer                                                  │
Ai4bio-alpa3: │    73 │   │   self._dummy_overflow_buf = get_accelerator().IntTensor([0])    │
Ai4bio-alpa3: │    74 │   │   self.multi_tensor_adam = fused_adam_cuda.multi_tensor_adam     │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:445 in load                                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   442 │   │   │                                                              │
Ai4bio-alpa3: │   443 │   │   │   return importlib.import_module(self.absolute_name())       │
Ai4bio-alpa3: │   444 │   │   else:                                                          │
Ai4bio-alpa3: │ ❱ 445 │   │   │   return self.jit_load(verbose)                              │
Ai4bio-alpa3: │   446 │                                                                      │
Ai4bio-alpa3: │   447 │   def jit_load(self, verbose=True):                                  │
Ai4bio-alpa3: │   448 │   │   if not self.is_compatible(verbose):                            │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/deepspeed/ops/ │
Ai4bio-alpa3: │ op_builder/builder.py:480 in jit_load                                        │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   477 │   │   │   torch_arch_list = os.environ.get("TORCH_CUDA_ARCH_LIST")   │
Ai4bio-alpa3: │   478 │   │   │   os.environ["TORCH_CUDA_ARCH_LIST"] = ""                    │
Ai4bio-alpa3: │   479 │   │                                                                  │
Ai4bio-alpa3: │ ❱ 480 │   │   op_module = load(name=self.name,                               │
Ai4bio-alpa3: │   481 │   │   │   │   │   │    sources=self.strip_empty_entries(sources),    │
Ai4bio-alpa3: │   482 │   │   │   │   │   │    extra_include_paths=self.strip_empty_entries( │
Ai4bio-alpa3: │   483 │   │   │   │   │   │    extra_cflags=self.strip_empty_entries(self.cx │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1284 in load                                                  │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1281 │   │   ...     extra_cflags=['-O2'],                                 │
Ai4bio-alpa3: │   1282 │   │   ...     verbose=True)                                         │
Ai4bio-alpa3: │   1283 │   '''                                                               │
Ai4bio-alpa3: │ ❱ 1284 │   return _jit_compile(                                              │
Ai4bio-alpa3: │   1285 │   │   name,                                                         │
Ai4bio-alpa3: │   1286 │   │   [sources] if isinstance(sources, str) else sources,           │
Ai4bio-alpa3: │   1287 │   │   extra_cflags,                                                 │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1508 in _jit_compile                                          │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1505 │   │   │   │   │   │                                                 │
Ai4bio-alpa3: │   1506 │   │   │   │   │   │   sources = list(hipified_sources)              │
Ai4bio-alpa3: │   1507 │   │   │   │   │                                                     │
Ai4bio-alpa3: │ ❱ 1508 │   │   │   │   │   _write_ninja_file_and_build_library(              │
Ai4bio-alpa3: │   1509 │   │   │   │   │   │   name=name,                                    │
Ai4bio-alpa3: │   1510 │   │   │   │   │   │   sources=sources,                              │
Ai4bio-alpa3: │   1511 │   │   │   │   │   │   extra_cflags=extra_cflags or [],              │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1600 in _write_ninja_file_and_build_library                   │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1597 │   get_compiler_abi_compatibility_and_version(compiler)              │
Ai4bio-alpa3: │   1598 │   if with_cuda is None:                                             │
Ai4bio-alpa3: │   1599 │   │   with_cuda = any(map(_is_cuda_file, sources))                  │
Ai4bio-alpa3: │ ❱ 1600 │   extra_ldflags = _prepare_ldflags(                                 │
Ai4bio-alpa3: │   1601 │   │   extra_ldflags or [],                                          │
Ai4bio-alpa3: │   1602 │   │   with_cuda,                                                    │
Ai4bio-alpa3: │   1603 │   │   verbose,                                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:1709 in _prepare_ldflags                                      │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   1706 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa3: │   1707 │   │   │   │   extra_ldflags.append(os.path.join(CUDNN_HOME, "lib",  │
Ai4bio-alpa3: │   1708 │   │   elif not IS_HIP_EXTENSION:                                    │
Ai4bio-alpa3: │ ❱ 1709 │   │   │   extra_ldflags.append(f'-L{_join_cuda_home("lib64")}')     │
Ai4bio-alpa3: │   1710 │   │   │   extra_ldflags.append('-lcudart')                          │
Ai4bio-alpa3: │   1711 │   │   │   if CUDNN_HOME is not None:                                │
Ai4bio-alpa3: │   1712 │   │   │   │   extra_ldflags.append(f'-L{os.path.join(CUDNN_HOME, "l │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │ /home/chong.tian/.conda/envs/med/lib/python3.10/site-packages/torch/utils/cp │
Ai4bio-alpa3: │ p_extension.py:2231 in _join_cuda_home                                       │
Ai4bio-alpa3: │                                                                              │
Ai4bio-alpa3: │   2228 │   only once we need to get any CUDA-specific path.                  │
Ai4bio-alpa3: │   2229 │   '''                                                               │
Ai4bio-alpa3: │   2230 │   if CUDA_HOME is None:                                             │
Ai4bio-alpa3: │ ❱ 2231 │   │   raise EnvironmentError('CUDA_HOME environment variable is not │
Ai4bio-alpa3: │   2232 │   │   │   │   │   │   │      'Please set it to your CUDA install ro │
Ai4bio-alpa3: │   2233 │   return os.path.join(CUDA_HOME, *paths)                            │
Ai4bio-alpa3: │   2234                                                                       │
Ai4bio-alpa3: ╰──────────────────────────────────────────────────────────────────────────────╯
Ai4bio-alpa3: OSError: CUDA_HOME environment variable is not set. Please set it to your CUDA 
Ai4bio-alpa3: install root.
Ai4bio-alpa3: [2023-06-03 05:32:02,341] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3871845
Ai4bio-alpa3: [2023-06-03 05:32:02,341] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3871846
Ai4bio-alpa2: [2023-06-03 05:32:02,550] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1788682
Ai4bio-alpa2: [2023-06-03 05:32:02,637] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1788683
Ai4bio-alpa2: [2023-06-03 05:32:02,637] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1788684
Ai4bio-alpa2: [2023-06-03 05:32:02,669] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 1788685
Ai4bio-alpa2: [2023-06-03 05:32:02,691] [ERROR] [launch.py:434:sigkill_handler] ['/home/chong.tian/.conda/envs/med/bin/python', '-u', 'fastchat/train/train_mem.py', '--local_rank=3', '--model_name_or_path', 'eachadea/vicuna-13b-1.1', '--data_path', './medVicuna.json', '--bf16', 'True', '--output_dir', 'output_medvicuna_13b/', '--num_train_epochs', '5', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '32', '--gradient_accumulation_steps', '32', '--save_strategy', 'epoch', '--save_total_limit', '10', '--learning_rate', '2e-5', '--weight_decay', '0.', '--warmup_ratio', '0.04', '--lr_scheduler_type', 'cosine', '--logging_steps', '1', '--model_max_length', '1024', '--gradient_checkpointing', 'True', '--lazy_preprocess', 'True', '--deepspeed', './configs/default_offload_opt_param.json', '--tf32', 'True'] exits with return code = 1
Ai4bio-alpa3: [2023-06-03 05:32:02,752] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3871847
Ai4bio-alpa3: [2023-06-03 05:32:02,782] [INFO] [launch.py:428:sigkill_handler] Killing subprocess 3871848
Ai4bio-alpa3: [2023-06-03 05:32:02,805] [ERROR] [launch.py:434:sigkill_handler] ['/home/chong.tian/.conda/envs/med/bin/python', '-u', 'fastchat/train/train_mem.py', '--local_rank=3', '--model_name_or_path', 'eachadea/vicuna-13b-1.1', '--data_path', './medVicuna.json', '--bf16', 'True', '--output_dir', 'output_medvicuna_13b/', '--num_train_epochs', '5', '--per_device_train_batch_size', '1', '--per_device_eval_batch_size', '32', '--gradient_accumulation_steps', '32', '--save_strategy', 'epoch', '--save_total_limit', '10', '--learning_rate', '2e-5', '--weight_decay', '0.', '--warmup_ratio', '0.04', '--lr_scheduler_type', 'cosine', '--logging_steps', '1', '--model_max_length', '1024', '--gradient_checkpointing', 'True', '--lazy_preprocess', 'True', '--deepspeed', './configs/default_offload_opt_param.json', '--tf32', 'True'] exits with return code = 1
pdsh@Ai4bio-alpa2: Ai4bio-alpa2: ssh exited with exit code 1
pdsh@Ai4bio-alpa2: Ai4bio-alpa3: ssh exited with exit code 1
